<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>taticus does it kill</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
	body, html {
		height: 100%;
		margin: 0;
	}
	.main-container {
		display: flex;
		flex-direction: column;
		height: 100vh;
	}
	.top-buttons {
		flex: 0 0 auto;
		display: flex;
		justify-content: center;
		gap: 1rem;
		padding: 1rem;
		background: #f8f9fa;
		border-bottom: 1px solid #ccc;
	}
	.bottom-bar {
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		display: flex;
		gap: 10px;
		padding: 1px;
		background: #f8f9fa;
		border-top: 1px solid #ccc;
	}
	.center-area {
		flex: 1 1 auto;
		position: relative;  
		background: #eee;
		/* background: url("img/background.jpg") no-repeat center center;
		background-size: cover; */
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.center-area h1 {
		color: #333;
	}
	.clickable-img {
		position: absolute;
		width: 120px;
		height: auto;
		cursor: pointer;
		transition: transform 0.2s;
	}
	.clickable-img:hover {
		transform: scale(1.05);
	}
	.bottom-left {
		bottom: 40px;
		left: 135px;
	}
	.bottom-left-panel {
		bottom: 10px;
		left: 260px;
	}
	.top-right {
		top: 40px;
		right: 135px;
	}
	.top-right-panel {
		top: 10px;
		right: 260px;
	}

	/* Stats panel */
	.stats-panel {
		position: absolute;
		width: 280px;
		padding: 15px;
		background: rgb(0, 0, 0);
		border-left: 1px solid #ccc;
		box-shadow: -2px 0 6px rgba(0,0,0,0.1);
		display: none;
	}
	.stats-row {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}
	.panel-icon {
		height: 30px;
	}
	.stats-line {
		margin: 5px 0;
		color: #ffffff;
		font-weight: bold;
	}
	.stats-images {
		margin-top: 15px;
	}
	.stat-with-number {
		display: flex;
		align-items: center;
		margin-bottom: 10px;
	}
	.stat-with-number img {
		width: 50px;
		margin-right: 10px;
	}
	.stat-number {
		font-size: 18px;
		font-weight: bold;
		color: #007bff;
	}
	.stats-images img {
		width: 50px;
		margin-right: 10px;
	}
	.dropdown {
		border: 1px solid #ccc;
		border-radius: 5px;
		max-width: 200px;
		background: white;
	}

	.dropdown-item {
		padding: 5px;
		cursor: pointer;
	}

	.dropdown-item:hover {
		background: #f0f0f0;
	}
</style>
</head>
<body>

<div class="main-container">
	
	<!-- Top Buttons -->
	<div class="top-buttons">
		<button class="btn btn-primary">Button 1</button>
		<button class="btn btn-success">Button 2</button>
		<button class="btn btn-danger">Button 3</button>
	</div>

	<!-- Center Area -->
	<div class="center-area">
		<h1>Main Content Area</h1>

		<!-- Bottom-left image named 1 -->
		<img id="icon_1" src="img/perso/noperso/icon.png" alt="Left Image" class="clickable-img bottom-left" onclick="showDropdown(1)">

		<!-- Menu déroulant selection perso (caché par défaut) -->
		<div id="dropdownMenu_perso_1" style="display:none; position:absolute; bottom:230px; left:20px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
		<select id="menuSelect_perso_1" onchange="showStats(1)">
			<option value="">-- Choisir un personnage --</option>
		</select>
		</div>

		<!-- Menu déroulant selection palier (caché par défaut) -->
		<div id="dropdownMenu_palier_1" style="display:none; position:absolute; bottom:10px; left:10px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
		<input type="hidden" id="palierValue_1">
		<div id="menuSelect_palier_1"></div>
		</div>

		<!-- Stats panel -->
		<div id="statsPanel_1" class="stats-panel bottom-left-panel">
			<div class="stats-row">
				<div class="stats-line" id="hp_id_1">0</div>
				<img id="palier_img_1" alt="icon" class="panel-icon">
			</div>
			<div class="stats-line" id="armor_id_1">0</div>
			<div class="stats-line" id="dmg_id_1">0</div>

			<!-- attack stats -->
			<div class="stats-images">
			<div class="stat-with-number">
				<img src="img/stat/mele.png" alt="mele" style="height:30px; width:30px; vertical-align:middle;">
				<img id="attack_mele_img_1"  alt="Small 1">
				<span id="attack_mele_nbr_1" class="stat-number">0</span>
			</div>
			<div class="stat-with-number" id ="attack_range_div_1">
				<img src="img/stat/range.png" alt="range" style="height:30px; width:30px; vertical-align:middle;">
				<img id="attack_range_img_1" alt="Small 1">
				<span id="attack_range_nbr_1" class="stat-number">0</span>
			</div>
			<img id="active_img_1"  alt="Small 2">
			<img id="passive_img_1"  alt="Small 3">
			</div>
		</div>




		<!-- Top-right image named 2 -->
		<img id="icon_2" src="img/perso/noperso/icon.png" alt="right Image" class="clickable-img top-right" onclick="showDropdown(2)">

		<!-- Menu déroulant selection perso (caché par défaut) -->
		<div id="dropdownMenu_perso_2" style="display:none; position:absolute; top:230px; right:20px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
		<select id="menuSelect_perso_2" onchange="showStats(2)">
			<option value="">-- Choisir un personnage --</option>
		</select>
		</div>

		<!-- Menu déroulant selection palier (caché par défaut) -->
		<div id="dropdownMenu_palier_2" style="display:none; position:absolute; top:10px; right:10px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
		<input type="hidden" id="palierValue_2">
		<div id="menuSelect_palier_2"></div>
		</div>

		<!-- Stats panel -->
		<div id="statsPanel_2" class="stats-panel top-right-panel">
			<div class="stats-row">
				<div class="stats-line" id="hp_id_2">0</div>
				<img id="palier_img_2" alt="icon" class="panel-icon">
			</div>
			<div class="stats-line" id="armor_id_2">0</div>
			<div class="stats-line" id="dmg_id_2">0</div>

			<!-- attack stats -->
			<div class="stats-images">
			<div class="stat-with-number">
				<img src="img/stat/mele.png" alt="mele" style="height:30px; width:30px; vertical-align:middle;">
				<img id="attack_mele_img_2"  alt="Small 1">
				<span id="attack_mele_nbr_2" class="stat-number">0</span>
			</div>
			<div class="stat-with-number" id ="attack_range_div_2">
				<img src="img/stat/range.png" alt="range" style="height:30px; width:30px; vertical-align:middle;">
				<img id="attack_range_img_2" alt="Small 1">
				<span id="attack_range_nbr_2" class="stat-number">0</span>
			</div>
			<img id="active_img_2"  alt="Small 2">
			<img id="passive_img_2"  alt="Small 3">
		</div>
	</div>

	<!-- <div class="bottom-bar">
		<button class="btn btn-primary">Button 1</button>
		<button class="btn btn-success">Button 2</button>
		<button class="btn btn-danger">Button 3</button>
	</div> -->

</div>

<script>

	async function loadMenuOptions(img_id) {
		// menu perso
		let response_perso = await fetch("mysqli/get_perso.php");
		let perso = await response_perso.json();

		let select_perso = document.getElementById("menuSelect_perso_"+img_id);
		select_perso.innerHTML = '<option value="">-- Choisir un personnage --</option>';

		perso.forEach(c => {
			let option = document.createElement("option");
			option.value = c.nom;
			option.textContent = c.prettyname;
			select_perso.appendChild(option);
		});

		// menu palier
		let response_palier = await fetch("mysqli/get_palier.php");
		let palier = await response_palier.json();

		let select_palier = document.getElementById("menuSelect_palier_"+img_id);
		select_palier.innerHTML = '';

		palier.forEach(c => {
			let item = document.createElement("div");
			item.classList.add("dropdown-item");
			item.innerHTML = `<img src="img/palier/${c.palier}.png" style="height:16px; margin-right:5px;"> ${c.palier}`;
			
			item.onclick = () => {
				// console.log("Selected:", c.palier);
				document.getElementById("palierValue_"+img_id).value  = c.palier;
				showStats(img_id);
			};

			select_palier.appendChild(item);
		});
	}

	

	function showDropdown(img_id) {
		document.getElementById("dropdownMenu_perso_"+img_id).style.display = "none";
		document.getElementById("dropdownMenu_perso_"+img_id).style.display = "block";

		document.getElementById("dropdownMenu_palier_"+img_id).style.display = "none";
		document.getElementById("dropdownMenu_palier_"+img_id).style.display = "block";
	}

	async function showStats(img_id) {
	const perso_nom = document.getElementById("menuSelect_perso_"+img_id).value;
	const palier_nom = document.getElementById("palierValue_"+img_id).value;
	// console.log("Perso:", perso_nom, "Palier:", palier_nom);
	if (perso_nom && palier_nom) {

		let response = await fetch("mysqli/get_perso_stat.php?nom=" + perso_nom+"&palier=" + palier_nom);
		let data = await response.json();
		// console.log(data);

		// afficher le panel et cacher les dropdowns
		document.getElementById("statsPanel_"+img_id).style.display = "block";
		// document.getElementById("dropdownMenu_perso"+img_id).style.display = "none";
		// document.getElementById("dropdownMenu_palier"+img_id).style.display = "none";

		// images
		// icon
		document.getElementById("icon_"+img_id).src = "img/perso/" + data.nom + "/icon.png";
		// active et passive
		document.getElementById("active_img_"+img_id).src = "img/perso/" + data.nom + "/active.png";
		document.getElementById("passive_img_"+img_id).src = "img/perso/" + data.nom + "/passive.png";

		// attaques
		// si nbr_hit_range = 0 alors on n'affiche pas l'attaque
		if(data.nbr_hit_range != 0){
			document.getElementById("attack_range_div_"+img_id).style.display = "block";
			document.getElementById("attack_range_img_"+img_id).src = "img/perfo/" + data.perfo_range + ".png";
			document.getElementById("attack_range_nbr_"+img_id).innerText = data.nbr_hit_range;
		}
		else{
			document.getElementById("attack_range_div_"+img_id).style.display = "none";
		}
		document.getElementById("attack_mele_img_"+img_id).src = "img/perfo/" + data.perfo_mele + ".png";
		document.getElementById("attack_mele_nbr_"+img_id).innerText = data.nbr_hit_mele;

		document.getElementById("palier_img_"+img_id).src = "img/palier/" + palier_nom + ".png";

		// stats
		document.getElementById("hp_id_"+img_id).innerHTML = '<img src="img/stat/hp_noir.png" alt="hp" style="height:20px; vertical-align:middle;"> '+ data.hp;
		document.getElementById("armor_id_"+img_id).innerHTML = '<img src="img/stat/armor_noir.png" alt="armor" style="height:20px; vertical-align:middle;"> '+ data.armor;
		document.getElementById("dmg_id_"+img_id).innerHTML = '<img src="img/stat/dmg_noir.png" alt="dmg" style="height:20px; vertical-align:middle;"> '+ data.dmg;

	}
	}

	document.getElementById("icon_1").addEventListener("click", loadMenuOptions(1));
	document.getElementById("icon_2").addEventListener("click", loadMenuOptions(2));


</script>

</body>
</html>