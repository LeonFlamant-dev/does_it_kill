<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>taticus does it kill</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
	body, html {
	height: 100%;
	margin: 0;
	}
	.main-container {
	display: flex;
	flex-direction: column;
	height: 100vh;
	}
	.top-buttons {
	flex: 0 0 auto;
	display: flex;
	justify-content: center;
	gap: 1rem;
	padding: 1rem;
	background: #f8f9fa;
	border-bottom: 1px solid #ccc;
	}
	.center-area {
	flex: 1 1 auto;
	position: relative;  /* allows absolute positioning of images */
	background: #eee;
	/* background: url("img/background.jpg") no-repeat center center;
	background-size: cover; */
	display: flex;
	align-items: center;
	justify-content: center;
	}
	.center-area h1 {
	color: #333;
	}
	.clickable-img {
	position: absolute;
	width: 120px;
	height: auto;
	cursor: pointer;
	transition: transform 0.2s;
	}
	.clickable-img:hover {
	transform: scale(1.05);
	}
	.bottom-left {
	bottom: 100px;
	left: 100px;
	}
	.bottom-left-panel {
	bottom: 70px;
	left: 300px;
	}
	.top-right {
	top: 100px;
	right: 100px;
	}

	/* Stats panel */
	.stats-panel {
	position: absolute;
	width: 280px;
	padding: 15px;
	background: rgb(0, 0, 0);
	border-left: 1px solid #ccc;
	box-shadow: -2px 0 6px rgba(0,0,0,0.1);
	display: none; /* hidden until image click */
	}
	.stats-line {
	margin: 5px 0;
	color: #ffffff;
	font-weight: bold;
	}
	.stats-images {
	margin-top: 15px;
	}
	.stat-with-number {
	display: flex;
	align-items: center;
	margin-bottom: 10px;
	}
	.stat-with-number img {
	width: 50px;
	margin-right: 10px;
	}
	.stat-number {
	font-size: 18px;
	font-weight: bold;
	color: #007bff;
	}
	.stats-images img {
	width: 50px;
	margin-right: 10px;
	}
</style>
</head>
<body>

<div class="main-container">
	
	<!-- Top Buttons -->
	<div class="top-buttons">
	<button class="btn btn-primary">Button 1</button>
	<button class="btn btn-success">Button 2</button>
	<button class="btn btn-danger">Button 3</button>
	</div>

	<!-- Center Area -->
	<div class="center-area">
	<h1>Main Content Area</h1>

	<!-- Bottom-left image -->
	<img id="bottom-left-icon" src="img/perso/noperso/icon.png" alt="Left Image" class="clickable-img bottom-left" onclick="showDropdown()">


	<!-- Top-right image -->
	<a href="right.php">
		<img src="img/perso/noperso/icon.png" alt="Right Image" class="clickable-img top-right">
	</a>
	</div>


	<!-- Menu déroulant selection perso (caché par défaut) -->
	<div id="dropdownMenu_perso" style="display:none; position:absolute; bottom:140px; left:10px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
	<select id="menuSelect_perso" onchange="showStats()">
		<option value="">-- Choisir un personnage --</option>
	</select>
	</div>

	<!-- Menu déroulant selection palier (caché par défaut) -->
	<div id="dropdownMenu_palier" style="display:none; position:absolute; bottom:100px; left:30px; background:white; border:1px solid #ccc; padding:5px; border-radius:5px;">
	<select id="menuSelect_palier" onchange="showStats()">
		<option value="">-- Choisir un palier --</option>
	</select>
	</div>

	<!-- Stats panel -->
	<div id="statsPanel" class="stats-panel bottom-left-panel">
		<div class="stats-line" id="hp_id">0</div>
		<div class="stats-line" id="armor_id">0</div>
		<div class="stats-line" id="dmg_id">0</div>

		<!-- attack stats -->
		<div class="stats-images">
		<div class="stat-with-number">
			<img src="img/stat/mele.png" alt="mele" style="height:20px; vertical-align:middle;">
			<img id="attack-mele-img"  alt="Small 1">
			<span id="attack-mele-nbr" class="stat-number">0</span>
		</div>
		<div class="stat-with-number">
			<img src="img/stat/range.png" alt="range" style="height:20px; vertical-align:middle;">
			<img id="attack-range-img" alt="Small 1">
			<span id="attack-range-nbr" class="stat-number">0</span>
		</div>
		<img id="active-img"  alt="Small 2">
		<img id="passive-img"  alt="Small 3">
		</div>
	</div>
</div>

<script>

	async function loadMenuOptions() {
		// menu perso
		let response_perso = await fetch("mysqli/get_perso.php");
		let perso = await response_perso.json();

		let select_perso = document.getElementById("menuSelect_perso");
		select_perso.innerHTML = '<option value="">-- Choisir un personnage --</option>';

		perso.forEach(c => {
			let option = document.createElement("option");
			option.value = c.nom;
			option.textContent = c.prettyname;
			select_perso.appendChild(option);
		});

		// menu palier
		let response_palier = await fetch("mysqli/get_palier.php");
		let palier = await response_palier.json();

		let select_palier = document.getElementById("menuSelect_palier");
		select_palier.innerHTML = '<option value="">-- Choisir un palier --</option>';

		palier.forEach(c => {
			let option = document.createElement("option");
			option.value = c.palier;
			option.textContent = c.palier;
			select_palier.appendChild(option);
		});
	}

	

	function showDropdown() {
		document.getElementById("dropdownMenu_perso").style.display = "none";
		document.getElementById("dropdownMenu_perso").style.display = "block";

		document.getElementById("dropdownMenu_palier").style.display = "none";
		document.getElementById("dropdownMenu_palier").style.display = "block";
	}

	async function showStats() {
	const perso_nom = document.getElementById("menuSelect_perso").value;
	const palier_nom = document.getElementById("menuSelect_palier").value;
	if (perso_nom && palier_nom) {

		let response = await fetch("mysqli/get_perso_stat.php?nom=" + perso_nom+"&palier=" + palier_nom);
		let data = await response.json();
		console.log(data);

		// afficher le panel et cacher les dropdowns
		document.getElementById("statsPanel").style.display = "block";
		// document.getElementById("dropdownMenu_perso").style.display = "none";
		// document.getElementById("dropdownMenu_palier").style.display = "none";

		// images
		// icon
		document.getElementById("bottom-left-icon").src = "img/perso/" + data.nom + "/icon.png";
		// active et passive
		document.getElementById("active-img").src = "img/perso/" + data.nom + "/active.png";
		document.getElementById("passive-img").src = "img/perso/" + data.nom + "/passive.png";

		// attaques
		// si nbr_hit_range = 0 alors on n'affiche pas l'attaque
		if(data.nbr_hit_range != 0){
			document.getElementById("attack-range-img").style.display = "block";
			document.getElementById("attack-range-nbr").style.display = "block";
			document.getElementById("attack-range-img").src = "img/perfo/" + data.perfo_range + ".png";
			document.getElementById("attack-range-nbr").innerText = data.nbr_hit_range;
		}
		else{
			document.getElementById("attack-range-img").style.display = "none";
			document.getElementById("attack-range-nbr").style.display = "none";
		}
		document.getElementById("attack-mele-img").src = "img/perfo/" + data.perfo_mele + ".png";
		document.getElementById("attack-mele-nbr").innerText = data.nbr_hit_mele;


		// stats
		document.getElementById("hp_id").innerHTML = '<img src="img/stat/hp_noir.png" alt="hp" style="height:20px; vertical-align:middle;"> '+ data.hp;
		document.getElementById("armor_id").innerHTML = '<img src="img/stat/armor_noir.png" alt="armor" style="height:20px; vertical-align:middle;"> '+ data.armor;
		document.getElementById("dmg_id").innerHTML = '<img src="img/stat/dmg_noir.png" alt="dmg" style="height:20px; vertical-align:middle;"> '+ data.dmg;

	}
	}

	document.getElementById("bottom-left-icon").addEventListener("click", loadMenuOptions);

</script>

</body>
</html>